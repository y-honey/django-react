import { useQuery } from '@apollo/client';
import { FormattedMessage } from 'react-intl';

import { RoutesConfig } from '../../../app/config/routes';
import { ButtonVariant } from '../../../shared/components/forms/button';
import { useGenerateLocalePath } from '../../../shared/hooks/localePaths';
import { mapConnection } from '../../../shared/utils/graphql';
import { {{ camelCase name }}ListQuery } from './{{ camelCase name }}List.graphql';
import { AddNewLink, Container, Header, List } from './{{ camelCase name }}List.styles';
import { {{ pascalCase name }}ListItem } from './{{ camelCase name }}ListItem';

export const {{ pascalCase name }}List = () => {
  const generateLocalePath = useGenerateLocalePath();
  const { loading, data } = useQuery({{ camelCase name }}ListQuery);

  const renderList = () => {
    if (!data) return null;
    return (
      <List>
        {mapConnection(
          (item) => (
            <{{ pascalCase name }}ListItem item={item} key={item.id} />
          ),
          data.{{ camelCase name }}List
        )}
      </List>
    );
  };

  return (
    <Container>
      <Header>CRUD Example Items</Header>
      <AddNewLink to={generateLocalePath(RoutesConfig.{{ camelCase name }}.add)} variant={ButtonVariant.PRIMARY}>
        <FormattedMessage id="{{ pascalCase name }}List / Add new" defaultMessage="Add new item" />
      </AddNewLink>

      {loading ? (
        <span>
          <FormattedMessage defaultMessage="Loading ..." id="Loading message" />
        </span>
      ) : (
        renderList()
      )}
    </Container>
  );
};
