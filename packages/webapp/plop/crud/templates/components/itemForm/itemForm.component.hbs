import { ApolloError } from '@apollo/client';
import { Link } from '@sb/webapp-core/components/buttons';
import { FormattedMessage, useIntl } from 'react-intl';

import { RoutesConfig } from '../../../app/config/routes';
import { Button, ButtonVariant } from '../../../shared/components/forms/button';
import { Input } from '../../../shared/components/forms/input';
import { useGenerateLocalePath } from '../../../shared/hooks/localePaths';
import { use{{ pascalCase name }}Form } from './{{ camelCase name }}Form.hook';
import { Buttons, Container, ErrorMessage, Fields, Form, Label } from './{{ camelCase name }}Form.styles';

const MAX_NAME_LENGTH = 255;

export interface {{ pascalCase name }}FormFields {
  name: string;
}

export type {{ pascalCase name }}FormProps = {
  onSubmit: (formData: {{ pascalCase name }}FormFields) => void;
  loading: boolean;
  initialData?: {{ pascalCase name }}FormFields | null;
  error?: ApolloError;
}

export const {{ pascalCase name }}Form = ({ initialData, onSubmit, error, loading }: {{ pascalCase name }}FormProps) => {
  const intl = useIntl();
  const generateLocalePath = useGenerateLocalePath();

  const {
    form: {
      register,
      formState: { errors },
    },
    genericError,
    hasGenericErrorOnly,
    handleFormSubmit,
  } = use{{ pascalCase name }}Form({ initialData, onSubmit, error });

  return (
    <Container>
      <Form onSubmit={handleFormSubmit}>
        <Fields>
          <Label>
            <FormattedMessage defaultMessage="Name:" id="{{ pascalCase name }} Form / Name label" />
          </Label>
          <Input
            {...register('name', {
              maxLength: {
                value: MAX_NAME_LENGTH,
                message: intl.formatMessage({
                  defaultMessage: 'Name is too long',
                  id: '{{ pascalCase name }} form / Name max length error',
                }),
              },
              required: {
                value: true,
                message: intl.formatMessage({
                  defaultMessage: 'Name is required',
                  description: '{{ pascalCase name }} form / Name required',
                }),
              },
            })}
            name="name"
            placeholder={intl.formatMessage({
              defaultMessage: 'Name',
              description: '{{ pascalCase name }} form / Name placeholder',
            })}
            error={errors.name?.message}
          />

          {hasGenericErrorOnly && <ErrorMessage>{genericError}</ErrorMessage>}
        </Fields>

        <Buttons>
          <Link to={generateLocalePath(RoutesConfig.{{ camelCase name }}.list)} variant={ButtonVariant.SECONDARY}>
            <FormattedMessage defaultMessage="Cancel" id="{{ pascalCase name }} form / Cancel button" />
          </Link>

          <Button type="submit" disabled={loading}>
            <FormattedMessage defaultMessage="Save changes" id="{{ pascalCase name }} form / Submit button" />
          </Button>
        </Buttons>
      </Form>
    </Container>
  );
};
